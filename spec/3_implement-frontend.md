# AI Short Video Generator フロントエンド詳細仕様書
フロントエンドは以下を担当します。

- 動画のアップロード（CloudStorageへの署名付きURL）
- AIによる動画解析（Mockしてください。）

```json
{
  "highlights": [
    {
      "start": 0,
      "end": 30,
      "title": "オープニングシーン",
      "description": "導入部分の説明",
      "score": 0.85
    }
  ]
}
```

- 動画のハイライト選択


- 選択したハイライトを元に動画の生成
- 動画のダウンロード



## 技術アーキテクチャ

本アプリケーションのフロントエンドは、Next.js 15を基盤として構築され、Google Cloud Runにデプロイされます。TypeScriptによる型安全性を確保し、Tailwind CSSとshadcn/uiを組み合わせることで、保守性の高いコンポーネント設計を実現します。

状態管理にはZustandを採用し、グローバルな状態を効率的に管理します。特に動画アップロードの進捗状況、AI解析結果、およびユーザーの選択状態などの重要な情報を一元的に管理することで、コンポーネント間のデータフローを簡潔に保ちます。

## ディレクトリ構造

プロジェクトのディレクトリ構造は、Next.js 15のApp Routerパターンに従い、以下のように構成します。

```
frontend/
├── app/
│   ├── layout.tsx
│   ├── page.tsx
│   ├── api/
│   └── globals.css
├── components/
│   ├── ui/
│   ├── video/
│   │   ├── VideoUploader.tsx
│   │   ├── VideoPlayer.tsx
│   │   └── VideoTimeline.tsx
│   └── analysis/
│       ├── AnalysisButton.tsx
│       └── HighlightSelector.tsx
├── lib/
│   ├── api/
│   ├── utils/
│   └── types/
├── stores/
│   └── videoStore.ts
└── public/
```

## コンポーネント設計

### VideoUploader コンポーネント

動画アップロード機能の中核となるコンポーネントです。ドラッグ&ドロップによる直感的なインターフェースを提供し、大容量ファイルのアップロードに対応します。

このコンポーネントは、Google Cloud Storageへの直接アップロードを実現するため、まずバックエンドAPIから署名付きURLを取得します。その後、取得したURLを使用してブラウザから直接Cloud Storageへファイルをアップロードすることで、バックエンドサーバーの負荷を軽減します。

アップロード中は、XMLHttpRequestを使用して進捗状況をリアルタイムで追跡し、プログレスバーで視覚的にフィードバックを提供します。エラーハンドリングも包括的に実装し、ネットワークエラーやタイムアウトに対して適切な再試行メカニズムを備えます。

### VideoTimeline コンポーネント

解析結果を視覚的に表現する重要なコンポーネントです。Canvas APIを活用して、動画の全体像とAIが検出したハイライト箇所を横軸のタイムライン上に描画します。

各ハイライトは、AIスコアに応じて色の濃淡を調整し、重要度を直感的に把握できるようにします。マウスホバー時には、該当セグメントのタイトルと説明をツールチップで表示し、クリックによって選択・選択解除が可能です。

タイムラインは、動画の長さに応じて自動的にスケーリングされ、長時間の動画でも効率的にナビゲートできるよう、ズームとパン機能を実装します。

### HighlightSelector コンポーネント

ユーザーが選択したハイライトを管理し、最終的な動画生成のインターフェースを提供します。選択されたセグメントは、開始時間順に自動的にソートされ、総時間が表示されます。

各選択項目には、個別の削除ボタンと、ドラッグ&ドロップによる順序変更機能を実装します。また、生成される動画のプレビュー時間を動的に計算し、ユーザーが最終成果物を予測できるようにします。

## API通信設計

バックエンドとの通信は、専用のAPIクライアントモジュールを通じて行います。このモジュールは、認証トークンの自動付与、エラーハンドリング、リトライロジック、およびレスポンスの型変換を一元的に処理します。

署名付きURLの取得、AI解析の実行、動画生成リクエストなど、各エンドポイントに対応する関数を提供し、コンポーネントからは単純な関数呼び出しで済むように抽象化します。

## パフォーマンス最適化

Next.js 15の新機能を最大限活用し、パフォーマンスを最適化します。動的インポートを使用して、必要なコンポーネントのみを遅延読み込みし、初期バンドルサイズを最小限に抑えます。

動画プレビュー機能では、HTML5 Video APIを効率的に使用し、必要な部分のみをストリーミング再生することで、メモリ使用量を抑制します。また、React.memoとuseMemoを適切に使用して、不要な再レンダリングを防ぎます。

## エラーハンドリングとユーザー体験

包括的なエラーハンドリング戦略を実装し、ユーザーに適切なフィードバックを提供します。ネットワークエラー、ファイルサイズ超過、非対応フォーマットなど、想定される各種エラーに対して、わかりやすいエラーメッセージと回復手段を提示します。

ローディング状態は、スケルトンスクリーンやプログレスインジケーターを使用して視覚的に表現し、ユーザーが現在の処理状況を常に把握できるようにします。

## レスポンシブデザイン

モバイルデバイスからデスクトップまで、幅広いデバイスに対応するレスポンシブデザインを実装します。Tailwind CSSのユーティリティクラスを活用し、ブレークポイントごとに最適化されたレイアウトを提供します。

特にタイムラインコンポーネントは、小さな画面でも操作しやすいよう、タッチジェスチャーに対応し、ピンチズームやスワイプによるナビゲーションを可能にします。

## セキュリティ考慮事項

フロントエンドにおけるセキュリティ対策として、すべてのユーザー入力を適切にサニタイズし、XSS攻撃を防ぎます。また、CSRFトークンを使用してクロスサイトリクエストフォージェリを防止します。

アップロードされるファイルは、クライアントサイドでも基本的な検証を行い、サポートされていないファイル形式や過大なファイルサイズを事前に検出して、不要なネットワークトラフィックを削減します。

この詳細仕様に基づいて開発を進めることで、高品質で保守性の高いフロントエンドアプリケーションを構築できます。各コンポーネントは独立性を保ちながら、統一されたデザインシステムとデータフローによって、一貫性のあるユーザー体験を提供します。